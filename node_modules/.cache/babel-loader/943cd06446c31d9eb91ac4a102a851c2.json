{"ast":null,"code":"var _jsxFileName = \"D:\\\\ali\\\\programming\\\\React\\\\avocation\\\\client\\\\src\\\\Components\\\\SubComponents\\\\AvocataForm.js\",\n    _s = $RefreshSig$();\n\nimport mavatar from '../media/avatar-m.png';\nimport favatar from '../media/avatar-f.png';\nimport loading from '../media/loading.gif';\nimport imageCompression from 'browser-image-compression';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TagInput = /*#__PURE__*/React.lazy(_c = () => import('../SubComponents/TagInput'));\n_c2 = TagInput;\n\nconst AvocataForm = ({\n  user,\n  avocatas,\n  updataAvocatas\n}) => {\n  _s();\n\n  const [savedTags, setSavedTags] = useState([]);\n  const [addedTags, setAddedTags] = useState([]);\n  const fileInput = useRef(null);\n  const [fileName, setFileName] = useState('');\n  const [isPosting, setIsPosting] = useState(false);\n  const [uploaded, setUploaded] = useState(false);\n\n  const saveTag = tagTxt => {\n    if (savedTags.indexOf(tagTxt) === -1) setSavedTags([...savedTags, tagTxt]);\n  };\n\n  useEffect(() => {\n    const controller = new AbortController();\n    fetch('/tags', {\n      signal: controller.signal\n    }).then(resp => resp.json()).then(tagsArr => {\n      setSavedTags(tagsArr.map(tagDoc => tagDoc.tag));\n    }).catch(console.log);\n    return () => controller.abort();\n  }, []);\n  useEffect(() => {\n    fileInput.current.addEventListener('change', ev => {\n      let file = ev.target.files[0];\n      if (!file) return setUploaded(false);\n\n      if (!file.type.startsWith('image/') && file.type !== \"audio/mpeg\") {\n        alert('please upload an image or mp3 file only');\n        ev.target.value = null;\n        setUploaded(false);\n        setFileName('');\n      } else if (file.size / 1048576 > 8) {\n        alert('file size it too big, files below 8MB only');\n        ev.target.value = null;\n        setUploaded(false);\n        setFileName('');\n      } else {\n        setUploaded(true);\n        setFileName(file.name);\n      }\n    });\n  }, []);\n\n  const submitAvocata = async ev => {\n    var _fileInput$current$fi;\n\n    ev.preventDefault();\n    setIsPosting(true);\n    const form = new FormData(ev.target);\n    const uploadedFile = form.get('media');\n\n    if (uploadedFile && uploadedFile.type.includes('image')) {\n      //compress images\n      const options = {\n        maxSizeMB: 1,\n        maxWidthOrHeight: 620\n      };\n      const compressedFile = await imageCompression(uploadedFile, options);\n      form.set('media', compressedFile);\n    }\n\n    form.append('creator', user.userName);\n    form.append('tags', addedTags.join(' '));\n    form.append('fileName', fileName);\n    form.append('contentType', (_fileInput$current$fi = fileInput.current.files[0]) === null || _fileInput$current$fi === void 0 ? void 0 : _fileInput$current$fi.type); //note optional chaining\n\n    fetch('/avocata', {\n      method: \"POST\",\n      body: form\n    }).then(resp => resp.json()).then(message => {\n      setIsPosting(false);\n\n      if (message.successful) {\n        updataAvocatas([message.avocata, ...avocatas]);\n        ev.target.reset();\n        setAddedTags([]);\n        setUploaded(false);\n      } else {\n        alert(\"couldn't post the avocata \" + message.error);\n        console.log(message.error);\n      }\n    }).catch(console.log);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: submitAvocata,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"header\",\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        alt: \"avatar\",\n        src: user.gender === 'male' ? mavatar : favatar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: user.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 17\n      }, this), isPosting && /*#__PURE__*/_jsxDEV(\"img\", {\n        alt: \"loading..\",\n        src: loading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 32\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n      placeholder: \"content/caption\",\n      required: true,\n      name: \"text\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(React.Suspense, {\n      fallback: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"loading...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 39\n      }, this),\n      children: /*#__PURE__*/_jsxDEV(TagInput, {\n        savedTags: savedTags,\n        saveTag: saveTag,\n        addedTags: addedTags,\n        setAddedTags: setAddedTags\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 13\n    }, this), uploaded && /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"fileData\",\n      children: fileName\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 27\n    }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n      id: \"upload\",\n      children: [\" Upload image/mp3\", /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        accept: \"image/*,audio/mpeg\",\n        ref: fileInput,\n        name: \"media\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      children: \"Publish\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 9\n  }, this);\n};\n\n_s(AvocataForm, \"zpdSPsRrjLPOCgCkiefb+dvkQYQ=\");\n\n_c3 = AvocataForm;\nexport default AvocataForm;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"TagInput$React.lazy\");\n$RefreshReg$(_c2, \"TagInput\");\n$RefreshReg$(_c3, \"AvocataForm\");","map":{"version":3,"sources":["D:/ali/programming/React/avocation/client/src/Components/SubComponents/AvocataForm.js"],"names":["mavatar","favatar","loading","imageCompression","React","useEffect","useRef","useState","TagInput","lazy","AvocataForm","user","avocatas","updataAvocatas","savedTags","setSavedTags","addedTags","setAddedTags","fileInput","fileName","setFileName","isPosting","setIsPosting","uploaded","setUploaded","saveTag","tagTxt","indexOf","controller","AbortController","fetch","signal","then","resp","json","tagsArr","map","tagDoc","tag","catch","console","log","abort","current","addEventListener","ev","file","target","files","type","startsWith","alert","value","size","name","submitAvocata","preventDefault","form","FormData","uploadedFile","get","includes","options","maxSizeMB","maxWidthOrHeight","compressedFile","set","append","userName","join","method","body","message","successful","avocata","reset","error","gender"],"mappings":"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","sourcesContent":["import mavatar from '../media/avatar-m.png';\r\nimport favatar from '../media/avatar-f.png';\r\nimport loading from '../media/loading.gif';\r\n\r\nimport imageCompression from 'browser-image-compression';\r\nimport React, { useEffect, useRef, useState } from 'react';\r\n\r\nconst TagInput = React.lazy(()=> import('../SubComponents/TagInput'));\r\n\r\n\r\nconst AvocataForm =({user, avocatas, updataAvocatas})=>{\r\n    const [savedTags, setSavedTags] = useState([]);\r\n    const [addedTags, setAddedTags] = useState([]);\r\n    const fileInput = useRef(null);\r\n    const [fileName, setFileName] = useState('');\r\n    const [isPosting, setIsPosting] = useState(false);\r\n    const [uploaded, setUploaded] = useState(false);\r\n\r\n\r\n    const saveTag =(tagTxt)=>{\r\n        if (savedTags.indexOf(tagTxt) === -1) setSavedTags([...savedTags, tagTxt]);\r\n    }\r\n    \r\n    useEffect(()=>{\r\n        const controller = new AbortController();\r\n        fetch('/tags', {signal: controller.signal})\r\n        .then(resp=> resp.json())\r\n        .then(tagsArr=>{\r\n            setSavedTags(tagsArr.map(tagDoc=> tagDoc.tag));\r\n        })\r\n        .catch(console.log);\r\n        return ()=> controller.abort()\r\n    }, [])\r\n\r\n    useEffect(()=>{\r\n        \r\n        fileInput.current.addEventListener('change', (ev)=>{\r\n            let file = ev.target.files[0];\r\n            if (!file) return setUploaded(false);\r\n            if (!file.type.startsWith('image/') && file.type !== \"audio/mpeg\"){\r\n\r\n                alert('please upload an image or mp3 file only')\r\n                ev.target.value = null;\r\n                setUploaded(false);\r\n                setFileName('');\r\n\r\n            } else if (file.size/1048576 > 8) {\r\n\r\n                alert('file size it too big, files below 8MB only');\r\n                ev.target.value = null;\r\n                setUploaded(false);\r\n                setFileName('');\r\n            } else {\r\n                setUploaded(true);\r\n                setFileName(file.name)\r\n            }   \r\n        });\r\n        \r\n    }, [])\r\n\r\n    const submitAvocata = async (ev)=>{\r\n        ev.preventDefault();\r\n        setIsPosting(true);\r\n        const form = new FormData(ev.target);\r\n\r\n        const uploadedFile = form.get('media');\r\n\r\n        if (uploadedFile && uploadedFile.type.includes('image')){ //compress images\r\n            const options = {maxSizeMB: 1,   maxWidthOrHeight: 620};\r\n            const compressedFile = await imageCompression(uploadedFile, options);\r\n            form.set('media', compressedFile)\r\n        }\r\n\r\n        form.append('creator', user.userName);\r\n        form.append('tags', addedTags.join(' '));\r\n        form.append('fileName', fileName);\r\n        form.append('contentType', fileInput.current.files[0]?.type); //note optional chaining\r\n\r\n        fetch('/avocata', {\r\n            method: \"POST\",\r\n            body: form,\r\n        })\r\n        .then(resp=> resp.json())\r\n        .then(message=>  {\r\n            setIsPosting(false);\r\n            if (message.successful){\r\n                updataAvocatas([message.avocata, ...avocatas]);\r\n                ev.target.reset();\r\n                setAddedTags([]);\r\n                setUploaded(false);\r\n            }else {\r\n                alert(\"couldn't post the avocata \"+ message.error);\r\n                console.log(message.error);\r\n            }\r\n            \r\n        })\r\n        .catch(console.log)\r\n    }\r\n\r\n    return (\r\n        <form onSubmit={submitAvocata}>\r\n\r\n            <div className=\"header\">\r\n                <img alt=\"avatar\" src={user.gender === 'male'? mavatar: favatar}/>\r\n                <p>{user.name}</p>\r\n                { isPosting && <img alt=\"loading..\" src={loading} />}\r\n            </div>\r\n\r\n            <textarea placeholder=\"content/caption\" required name=\"text\"/>\r\n\r\n            <React.Suspense fallback={<div>loading...</div>}>\r\n                <TagInput \r\n                    savedTags={savedTags} \r\n                    saveTag={saveTag} \r\n                    addedTags={addedTags} \r\n                    setAddedTags={setAddedTags}\r\n                />\r\n            </React.Suspense>\r\n\r\n            { uploaded && <span className=\"fileData\">{fileName}</span> }\r\n\r\n            <label id=\"upload\"> Upload image/mp3\r\n                <input type=\"file\" accept=\"image/*,audio/mpeg\" ref={fileInput} name=\"media\"/>\r\n            </label>\r\n            <button>Publish</button>\r\n\r\n        </form>\r\n    );\r\n}\r\n\r\nexport default AvocataForm;"]},"metadata":{},"sourceType":"module"}